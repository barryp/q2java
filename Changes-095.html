<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<TITLE>Changes - v0.9.5</TITLE>
</HEAD>
<BODY>
<FONT face="Arial,Helvetica" size="+2">
<B>
<I>      
        Changes in Q2Java 0.9.5</I>
</B>
</FONT>
<P></P>
    
      Three big changes this time: the grappling hook code has been split
      from CTF, the code responsible for changing levels has been split from 
      BaseQ2, and the code responsible for generating the DOM documents describing
      a level has been generalized and made more flexible.
    <P></P>
    
      The GrapplingHook code still resides in the q2java.ctf package, but 
      is not tied directly to the CTFPlayer class anymore.  A new gamelet
      named q2java.ctf.GrapplingHook can stick a grappling hook in the inventory
      of any instance or q2java.baseq2.Player - which means you can use the GH
      in plain DM, Paranoia, BountyHunters, and hopefully in any future Q2Java game.
    <P></P>
    
      The basic level changing code, which watches the timelimit and fraglimit, initiates
      intermission, and chooses which map comes next has been placed in a new gamelet
      named q2java.baseq2.LevelChanger.  This gamelet can easily be extended to use some
      other method of choosing maps or deciding when to change.  However, if this gamelet or 
      something similar to it isn't loaded, the server will never change maps.
    <P></P>
    
      The Game class now creates a barebones DOM document when a level first starts, and 
      fires off a GameStatusEvent.GAME_BUILD_DOCUMENT event to give interested objects
      (such as barryp.map.XMLMaps gamelets) a chance to place map info into the document.
      It then checks to see if the gamelets have supplied any entity info, and if they
      either haven't at all or have included the &lt;include-default-entities/&gt; tag, 
      the Game will cause the string passed up from the .bsp file by the Engine to
      be parsed so that default entity info is included in the document before
      firing GameStatusEvent.GAME_PRESPAWN.  This new scheme makes it easy for
      multiple sources to contribute to the initial level document.
    <P></P>
  <P></P>
<CENTER></CENTER>
<TABLE width="100%" cellpadding="8" cellspacing="2" border="0">
<TR>
<TD colspan="2" align="center">
<FONT face="Arial,Helvetica">
<B>
<I>Changes in Java Classes</I>
</B>
</FONT>
</TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.baseq2.BaseQ2</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#000000">
<FONT color="#ffffff">Removed<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      Everything related to changing levels - from watching the fraglimit
      and timelimit to deciding what the next map will be.  This has all 
      been split off into a new gamelet q2java.baseq2.LevelChanger.  If that 
      gamelet or one similar to it isn't loaded, the map will never change now.
    </TD>
</TR>
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.baseq2.GenericWeapon</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      getOwner() method - to complement setOwner()
    </TD>
</TR>
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.baseq2.LevelChanger</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      New gamelet responsible for deciding when to change levels, initiating 
      the intermission mode, and choosing the next map.  Can easily be extended 
      or replaced with other gamelets that choose maps in a different way.
    </TD>
</TR>
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.baseq2.Player</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      Class now implements GameStatusListener so it can listen for notifications
      of when to begin intermission.
    </TD>
</TR>    
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      The two variations of addWeapon() are now public (was needed to support
      the new GrapplingHook gamelet).
    </TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      getIntermissionSpot() for choosing where a player should be placed during intermission.
    </TD>
</TR>
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">CheezHankrn</FONT>
</FONT>
</TD>
<TD>
      playerThink() now avoids calling fWeapon.weaponThink() if fWeapon is null -
      in preparation for future code that might have players wielding no weapons 
      at some points.  More work needs to be done though, since there's no real
      easy way to put the player in a no-weapon state - the game currently assumes
      you at least have a handblaster.     
    </TD>
</TR>
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      print() method updated to pay better attention to the destination field
      of a PrintEvent, and display messages on the new PRINT_TALK_PRIVATE channel
      slightly differently than plain PRINT_TALK messages.
    </TD>
</TR>
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      spawn() now fires a PlayerStateEvent.STATE_SPAWNED event to let interested
      objects know the player has spawned (the GrapplingHook gamelet is interested
      in this so it can slip a grappling hook weapon into the player's inventory)
    </TD>
</TR>    
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      startIntermission() now calls getIntermissionSpot() to find an intermission
      spot - rather than being passed that info as a parameter.  This means that 
      different players may now see different intermission spots (unlike stock Q2), 
      but that should just make life more interesting. 
    </TD>
</TR>   
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      teleport() now fires a PlayerStateEvent.STATE_TELEPORTED event to let interested
      objects know the Player has made a -drastic- change in position. (The grappling
      hook is interested in this - since it needs to reset if a player teleports).
    </TD>
</TR>         
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.baseq2.event.PlayerStateEvent</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      STATE_TELEPORTED constant for events signalling that the player
      has stepped through a teleporter.
    </TD>
</TR>  
    <TR valign="top">
<TD bgcolor="#000000">
<FONT color="#ffffff">Removed<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      STATE_SUSPENDEDSTOP constant wasn't being used, and had the same
      value as STATE_INVALID.
    </TD>
</TR>
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.baseq2.spawn.item_breather</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      stateChanged() altered to only reset on death or disconnection, didn't
      want to reset when the player goes through a teleporter
    </TD>
</TR>    
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.baseq2.spawn.item_enviro</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      stateChanged() altered to only reset on death or disconnection, didn't
      want to reset when the player goes through a teleporter
    </TD>
</TR>    
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.baseq2.spawn.item_health_mega</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      stateChanged() altered to only reset on death or disconnection, didn't
      want to reset when the player goes through a teleporter
    </TD>
</TR>    
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.baseq2.spawn.item_invulnerability</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      stateChanged() altered to only reset on death or disconnection, didn't
      want to reset when the player goes through a teleporter
    </TD>
</TR>    
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.baseq2.spawn.item_quad</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      stateChanged() altered to only reset on death or disconnection, didn't
      want to reset when the player goes through a teleporter
    </TD>
</TR>    
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.baseq2.spawn.worldspawn</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#000000">
<FONT color="#ffffff">Removed<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      worldspawn no longer does anything with the "nextmap" spawn parameter.
      Anything interested in that info (such as the new LevelChanger gamelet)
      can examine the level document to find it.      
    </TD>
</TR>    
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.core.DefaultLevelDocumentFactory</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#000000">
<FONT color="#ffffff">Removed<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      Class removed, most code now moved to q2java.core.GameUtil
    </TD>
</TR>    
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.core.Game</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#000000">
<FONT color="#ffffff">Removed<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      Everything related to the obsolete LevelDocumentFactory interface including setLevelDocumentFactory()
      and getLevelDocumentFactory().
    </TD>
</TR>    
    <TR valign="top">
<TD bgcolor="#aa0000">
<FONT color="#ffffff">Fix<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      bprint() was causing double messages to be displayed on the console. Now
      it -only- fires off a PrintEvent, so it'll be up to some other code, probably
      some type of gamelet, to relay the message down to the console.
    </TD>
</TR>   
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      getCurrentMapName() for finding out the current map name (duh). This info
      -could- be gotten from the level document, but the level document could also
      be screwed with, so the Game class now keeps a copy of the info that can 
      be relied on.
    </TD>
</TR>  
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      getOccupancySupport() to get access to the object the Game class uses
      to fire off OccupancyEvents.
    </TD>
</TR>       
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      startIntermission() to fire off a new GameStatusEvent to let objects know
      that they should go into intermission mode.  The new LevelChanger gamelet
      calls this when it decides it's time to move on.
    </TD>
</TR>       
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      startLevel() reworked to allow multiple objects to contribute to building 
      the DOM document describing the level, by creating a mostly-empty level document
      and firing off a GameStatusEvent.GAME_BUILD_DOCUMENT event when the level is first
      starting.  startLevel() also fills in the document with the info passed up from
      the .bsp file by the Q2 engine if necessary.
    </TD>
</TR>  
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.core.Gamelet</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      grabPlayers() now fires off a OccupancyEvent.PLAYER_CLASSCHANGE to let
      interested objects know that player classes are changing.  (Was necessary for
      the grappling hook gamelet, so it could register itself with the new player 
      objects).
    </TD>
</TR>  
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.core.GameUtil</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      buildLevelDocument() can either build a mostly-empty level document
      that can be filled in by various sources, of a full one if a map entString
      is passed.
    </TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      parseAngle3f() and parsePoint3f() moved back here from the obsolete q2java.core.DefaultLevelDocumentFactory
    </TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      parseEntString() can parse a map's entString and insert the data into
      an existing DOM document.  Used by buildLevelDocument() and Game.startLevel().
    </TD>
</TR>    
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.core.LevelDocumentFactory</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#000000">
<FONT color="#ffffff">Removed<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      This interface is no longer needed due to the new level document building system.
    </TD>
</TR>
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.core.XMLTools</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
       copy() method can copy nodes from one document to another - handy
       for merging multiple map data sources together.
    </TD>
</TR>
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.core.event.GameStatusEvent</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      GAME_INTERMISSION constant for events that signal when intermission 
      should begin
    </TD>
</TR>  
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      GAME_BUILD_DOCUMENT constant for events that signal when objects
      should consider contributing info to the next level's document
    </TD>
</TR>  
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      getMapEntities() and getSpawnpoint() to find out about what was specified
      by the engine during the GAME_BUILD_DOCUMENT event. 
    </TD>
</TR>  
    <TR valign="top">
<TD bgcolor="#000000">
<FONT color="#ffffff">Removed<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      constructor taking (int, String) parameters wasn't being used.
    </TD>
</TR>
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.core.event.PrintEvent</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      PRINT_TALK_PRIVATE constant added as a channel for private messages
    </TD>
</TR>    
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      getEvent() and releaseEvent() made public.
    </TD>
</TR>    
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.ctf.CTFPlayer</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      clearSettings() no longer worries about giving the player a grappling hook.
      This means that in order to have a GH in CTF, you must load the GrapplingHook
      gamelet in addition to the CTF gamelet.
    </TD>
</TR>    
    <TR valign="top">
<TD bgcolor="#0000cc">
<FONT color="#ffffff">Change<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      playerThink() no longer is aware of the grappling hook - the hook
      itself is now smart enough to register as a PlayerMoveListener and do
      what it needs when a PlayerMoveEvent is fired from inside q2java.baseq2.Player.playerThink().
    </TD>
</TR>    
    <TR valign="top">
<TD bgcolor="#000000">
<FONT color="#ffffff">Removed<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      teleport() method that overrode q2java.baseq2.Player.teleport() no longer needed
      since the grappling hook is smart enough to listen for PlayerStateEvent.PLAYER_TELEPORTED
      and reset itself as necessary.
    </TD>
</TR>
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.ctf.GrappleWeapon</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      This class used to be named q2java.ctf.spawn.weapon_grapple, but since
      that's not an item that appears in maps, it seemed cleaner to move
      it outside the q2java.ctf.spawn package.
    </TD>
</TR>    
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      Objects of this class register as PlayerMoveListeners when the
      weapon is active, and playerMoved() is called so the hook gets a chance
      to pull the player along.
    </TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      Objects of this class register as PlayerStateListeners so they can 
      watch for the player teleporting and reset the weapon if that happens..
    </TD>
</TR>
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.ctf.GrapplingHook</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      New gamelet that should add the grappling hook to q2java.baseq2.Player
      or any subclass.
    </TD>
</TR>    
  <TR>
<TD colspan="2"></TD>
</TR>
<TR>
<TD colspan="2">
<B>
<FONT face="Arial,Helvetica" size="+1">q2java.ctf.spawn.weapon_grapple</FONT>
</B>
</TD>
</TR>
    <TR valign="top">
<TD bgcolor="#00aa00">
<FONT color="#ffffff">Added<BR>
<FONT size="-2">Barry</FONT>
</FONT>
</TD>
<TD>
      This class was renamed to q2java.ctf.GrappleWeapon since
      that's not an item that appears in maps, and seemed cleaner to move
      it outside the q2java.ctf.spawn package.
    </TD>
</TR>    
  <TR>
<TD colspan="2"></TD>
</TR>
</TABLE>
<HR>
<DIV align="right">
<FONT size="-1">
<A href="http://www.planetquake.com/q2java">Q2Java homepage</A>
</FONT>
</DIV>
</BODY>
</HTML>
